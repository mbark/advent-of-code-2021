package main

import (
	"fmt"
	"github.com/mbark/advent-of-code-2021/maps"
	"github.com/mbark/advent-of-code-2021/util"
)

var (
	testData = `
v...>>.vv>
.vv>>.vv..
>>.>v>...v
>>v>>.>.v.
v>v.vv.v..
>.>>..v...
.vv..>.>v.
v.v..>>v.v
....v..v.>
`

	in = `
v..v>..>v.....v>.v>..v>>.>>..v>...>.v>....v..v.v......>>.v....>.......v.v..>....>..>>>>>...v>v.v>>v.v.vv.>v>......>>v....>v>>vvv>v.v>......
>.v.>>........v>.......v....v...>....>>.>......>v.v..>>.>.v>>.v.v>vv..v...>.>..v....v....>vv>>..vv..v>>vv.vv>>.v.>vv.v>>.vv>>vv.vv.vv.v...v
.v..>>v...v.v>>.>>.v.>>>>v.......v.vvv>v.>....>>......>>.>v>..>>.>.v...v.vv.vv>>.v..>>..vv>..>>>>..vv.vv>.v>v...........>.>vv..>>..v.>>..v>
>.>>.vv...v>>v>....vv>vv>....vv....>>.>>...>...v>v.>>vvv.>vv.v>v...>.>>>.>...>>......>>.>>......>>v>>...v..v>..v.>..v>>......>.>...vv.vv>>v
....v...>>v.>.v..v>..v...>..v>..>>.>...>v>>v..>...v>>...vv.v...v>vv...v>.>.>v>.v..>.>>>>.v>..v...v.vv>v>>..v.vv>>>v.>>>>...v.>..v.>..>.v...
v>...>>>>vv>....>v..>..>.v...v.vv>...>v>..>>>>.v.>.vv>....>..>>v>>...v>>>.>.>.>.>v...v...v...v>v...>....v>.>vv..>>.v...vv.>...vv.v.....v>>.
>..>.>.v>>vvv.>...>.>>.v.v>>>>>v>>v..>...v...>.>vv>.vvvv.v>>..>..>.v...vv.v..v>...v..v..v.v..>>...>.vv>...>......>.vv.v....vv.v...>.>.v>...
.>.....vv...v.>>..v.v...>v.vv.v.>v.>..v..v>>..v...v.v..>.>v.>..v.v.>>>.>.>v>.v..>>>v.v.v..>>......v.v..>...>........>>.v..v>..v.vvv.>..>...
vv..v.>.>.>.v>>>.v>..v..v>..>........v>..v..vv.>..v.v..>.v>>>>>...vv..>.v>>.vvv>.v>v.>v.>.vv>.v>vv.v.v.v.v>v.v..>.v.v..>>v.>..v.v>>...vv>..
>>v.>>.v..v>vvv>.v>.vv.>v.>>v..v.>v...>...v>vvv...>v.>>..>>.v....v.v...>.>.>v.>.v.>.>>>.>.>..vv.>..>>v>..>>.>>>....v...>.>>.>...v..v.vv>>>.
v..>.vv>v....>.vv>.v...>>..v.....>...>v.vv>v...>v.>>.>>.v.v.v.v......vv>...>..v>>.vvv...>v>....>v.v....vv.....v.>>....v>>....v..>>vv.>.>.v.
>>v.vv>vvvv.v.vvv.vv>.>.>>>.......v....v...v...>>>>v>.>.v...v.v>v.v.>vvv>>v..v.>.>...>.>..>...v>.>..vvv>vvv>..v>..>>v.v..v...>vvv.....>.>>>
..v>v>..v>>......>..>>>vv.....>>.>v.>..v...>....>vv>v.>..>v>>...v.....vv>.vv.....>..v.......v.>>..v..>.>>>>v>.vv>....v.>>v>v>.v..>.>v>v>v.v
...>v>>v..vvv.>..v>.>>.>.>v>vv>..v..>>.v>>..v>>vv.......vv>.>.>>....vv...v.>v.v.>v>v.>..v.>.....v.>>vv.vv>...v..>..>..>...vv.v>..>>.>>vv.v>
.v.>..v.v.>.>vvv.vv.v>v>>.v>v>>...>.v.v>.v..>>.....v...>.v.>..>.>.v...vv..v.......v.v.v.v..>v>....v...>v.vv.v.v>>v....>.>.>.>>>vv.....>..v>
>.>.>.>>.>.v..v>v.v......>>.v.v.v.v..>.>>..v>>.vvvvv...>v.vv.......v.>>>......v>.>v>v.v.v>v>>.....v..>.v.>>...>...v......v.>>.>.v.>.v.>.>.v
..>>v...v.>>>>v>>...>>v...v.v..v>>>v>..vv>.>..>.>>v......vv.v>.vv>>...v.>v..>v.....v>v.v>>>.>.v>v.v...v>vv.>>.>v>vvv.>v..>...>....v>>>v.vv>
.....vv>.>.>.vvvvv>.>v>.>.>..v..v>.>>........vv.v.>..v..>v..vv.v..>..>..>..>>.....vv>>......>.vv..v.>>v.>.vvv.>v.vv>.>v......>v>..vvv.>..>v
...>>....>.>v...>........v>..v..v>v..>>>..v>..>v>vv...v......vvv>vvv....>.v.>..>..>vvv.>...v.>..>vv.>v.>......>>.v..vv.....vv.v>.v..v>v.v>.
.>...v..>>.v>..>...vvv.v>...vv.>.v.>v...>>vv>>>.>v>>..v.>.v.v>.>..v.vv.>.>...>>.>.>.......vv....vvv.v..v.v>.vvv>..>....vvv..>.>v>..>.v....>
.v..v..>.vv>>v..>..v>vv..>>.....>..>v.v>vv>>v..vvvv...>.>v.>v......>v..>vv.....>v.v..>>v.v..v....>>.v.v>.....v.>...>.v...v..>.>.>.>v>v.>..>
.v..v>v>vvv>v.v..>>.v>vv..vv.>.v......v....>.......vv..>.v.>....v..v>v..vv.v..>.>.v>.v>v......>.v>v>>>.v.v.>...>>>v>>>......v.v>.>v..>>.vv.
v.>..vv.v......v>>..v....>.v...>>.v>>v..vv.v.v...>>v.......v>>.>v>v.vv...>...>v.vv....v>>.>v.>>.vv...>v...>.....>>>..v..v.v.v.>>...v..>..>.
>>>>..>vv..v...v>v.>....>.vv>>.>.v>..v>.v>.vvvvvv>....vv..v>v..>...v>>...>v.....v>vv.v>>>v.v>.....v.v.>.v.v.>>>>.>....v>.v>.v>..>....v>>v>>
>>>vv>.v.>..v..>.>.v>>vv...vv.v>vv.>...>.vv>..v....>.>>v..v.v>v...>v..>.v.>>>>vv.....>>vvvv>>....v..>...>.>>..vvv>.v>v.>.>>v>v>v>..........
.>v>>....v...>>...v.v.v>.>.v..>.v.>>.>..v..v..v>>..>..>..v.v>.vv...v>.>>...v.vvv>vv>v>..>...v>.v....>..vv..>.v.....v...v..>..>.>>.v>.v.....
v>v.vv..v.v...>..>v>vv.vv..v..v..>..v...v..v.v>.>...>>>>...>>......>>.v..>..v....>>>..v..>.>..>..v>...>v.>..vv>....>.>....v.>.>vvvv.>>..>.>
vv.vvv.....>v>.v...>v.v.....>.v.>v..>.>v>vv>>vv>.>>>>>>>vv>.v.v...>..>>>v.v.>>v..>>......>...>..>..>...v.>...v..>.>v..v.v....vvvv>.v.>>vv..
..>.>.>>.>>v.....v>>......v>.v...>v...>>>.v..v..v.>>.vvvvv.v....vv>>vvv>.>....>v.v>....>>.v..>.v.vv>........>...vv...v.vv.>.v.....>vv>.>>>.
>v.......v..v.vvv..v.>.>........v..>.>..>>.v.v....v.v.>v.v.>.v..v>>..>v...v.v>.v..v.>v....v.>>v>>.>>vvvv.>...vv.v.v.>>.vvvv...v>v>..vv>.vv.
vv......v>...>...>v..v.>>.v>vvv.>>>.......>.v>.>..vv.v...v>..>....>..v>.v>v>.v.>.vv>..>v..>vvvv.......>v.>..>>..v.v..>>>>v.v>vvvvv.>.>>.>>.
v>>>>>...>.>....>.>>v.>v...v..>v.>..>.v...>v>v.v.>v>>>>>..v.>>.>>....v>..v.v.>>>>....>v.vv..v.>..v.>>.>>v>.>.v>v.>.>>>...v>..>....>.v.v..>v
...v.....>>.v>vvv.>>v>.v>..>vv...v>.>..>>v>..>.>.v.v..>>..>v..>.vv>>....v..vv>v....vvvv..>>v.>>.vv.v.vv.>v..v......v..>.v>v....v>.vvv>...>.
v.v.>.v..>>>.....v..v....>.v...>.....>>>>v.>v.>>..>v>...>v..>vv.>...>vv>...>.>v..v....>.>.>v.....vv>>.v..>vv.v..v..>.>.v...>>v.v.>vv>v.>...
>>vv..vv.>.v..>vv>vv..v>v>>>..vv..v.>.v>vv...>v..v..v.v>v>.v.>v>>.>v.>..>.v>..>....>>.>v.v.v>..v...>>>>>vv...vv...>.>..vv.>..>>v>.v....>>.>
vvv.vv..>.v>v>vv>.vv...>....>>.>>.>....>vv.>v...v.>..v>.v.>v.v>v.>....>v..>>....>.>.>v....v..v....>.>v.>.v....>>..>>v.vvv.........>>>...>..
>>>>....v>>..>>.v.v.>.>v>>vvv>>>..v.v..v>.vvv.>.>.......>..v>.>.>v.>..v>.>>...v>v>vv.....>>.>>.>>.v..>vv.>v>v..v..vv.vv.>.>vvv>.>.v..>v>>>v
>.>.vv.v>>v....vv..>....v.vvv.v.>v>...v>>..>.v...v>.v.v....>.>vv...v>..v..>.>>...v>.>>.v>vvv>vvv...>...>..>v..vv..>.v.>.v...v>>>..v..v..>vv
.vv.v.>v.v>vv..>.vv..v.v>.v>.>...>....vv...v>vv>v.....v>v>>>........vvvvv>>v...>>v...v..vv.v..>v.>vvv....v...>v.v>...v>vvv.v>.v.v..v...>..v
.>v>>>.>>v.v.>v.>..vvv..>>v.>v...>.v..>>>.>.>v.v>.v.v..>....v.....>.>.>>....>..>>v...v>v.v>>..>vv>v.....v.vv.v..vvv...>>>.>>..>>>vv>>.vv.>v
.vv..>v....v...vv>>.v.>>..v.>.>v.....>..vvv>.>.vv..>.vv...>v.>v....vv>..vv..v.>..>....v>>v.>v..v.v..v>>v..v.>>.v......v.>.v.v>>>v..v.v.>v>v
>>.v.>v..>....>>v..v>v>..>...v>..>vvvv.>>>.>....>..vvv...v..v>>>.vv.>>...v...v..v......>v.vv.>v.>v>v.vv....>............>v.v>>.v.v>v>..>>v.
>.vvv..>..vvvv.....vv..>.>..v>>v>..v>>vv..>v.v>..v>..v..>...>...>.>..>.v.>...>.>.>.>>v.v..>.>...>.v>..v>..>v>>.v>.v.v....v>v..>.v>v.v>.>...
>.>>.v.v.v>>...v...>v.>..>.......>.v.>...v>>.v>>.>>>v>.>v..v....v.>...>>>..>v.>v.vvv...>.>>........>>.....>>v.>..>.v>v>..vvv.>.............
v..>>..>..vv.v.>>>..v>>...vv>....>>.>>...>.>vv.v.v..>..vvv.>>>>..>>v>.v.v>.vv.v>...v...>..>............>.>v>.v.>vv.v.>....>vv.>.>.v...vv...
.>v>v.......>>>.>.>.v.>v>.v.v>>vvv.vv.v>>>>..>.v..>v..>..>.v...>>...v.v...v.>...vvvv>>...v..vvvv.>v..>.......>>....>..vvv.>..>>......v>>...
....>...>.v...vv..v...>...v>.>v>..>v>.v>.v>>v..v>..>....v.v.>.....>.vv.v>>.>..>.v>>>.v>.>v>..v.vv>>.v>..v.......v...>..v.v.....vv>v..v.....
v..vv.>v.v...>..>..>v.v..v...>......>....v.vvv>v.>.v>>..v.>.v>vv...v.vv.>.v.v.v.vvv..>..>..v.>.>.v>v..v>.>.>v.v..v...v.>vv>>.......v>>v>.>v
>..v.v......>..>..>>......v>.vv.v>v.>>..v.>vv>>>>..v.>v.......v.>.>...>v>..v>..>.>>.....>.....>.v.>.>>>>.v.v.v>>...>.v..vvv.........>vv...v
..>....>>v...v>..vv...>.vv>v...>v>>vv.>..>>.......>>v>>v.>>.>.>>...v.v>.>.>......>.vv..>v.>>...v>...>.>>>.>vv>..vv.......>>>>..vv..vv...>>.
.>.v..>.......v.>......v.>vvv.v>v.v..v>.v.v...>>.>...>.>>....v>>v>..>...>>.v>.vv.vvv...v.>v.>.v.>.>vvvv..v...>.>>...vv...v>.v....v>..>..>vv
>.vv.v>v...>...>.>>>vv>...>.....>.v>.>.>...>...v..v.v.vv...>>.v.vv....v.>>>.v.vv.v.v.vv....>.vv....>>.v>>.>.vv...>v>>..v>.v.v>vvv>vvv>v.vvv
vv>>...v..>.v..v.>v>.v.v.....v>v.>.v..>vv.v...v..v.>.v>..>.....v.v>....>v.>.vv>v...vvvv.v.>>..>.v>.v>.>v.>v....v>.>..>vvv..>v.>>.v.vvv>...v
>..v>......>>v>.v.......v.v.v.v....>>.>.v..>vv..v..>..v>v..>>v.>.v>v.>>..>v.v..v.>v>>>.>>..v>>.>.>..vv>.>.>>.>v.>.>>>.v....>.>......v>.vv.v
v.v...v.>.>>v.>.>..v.vv>v..v..>..>..>v.>v.>.vv>.>...vvv>>vv>v>....vvv.v.......>..>v>.>v>v..v.....v.>...>..v..v.v>..>v>v..>v>..>v>>.v.v>..>v
v..vv...v>>v>>..>>..>...vv.>..>v...>.v....>vv>..>>vv.....>vv.v..>v.>..vv..>v>>..v.>...>.>>v.v>.>>>.v..v>>..v.v..>.v.v>.v.>....v>>v.vv>>....
.>>.v.>..v....>>v.v..vv.v.>..vv.>..>v.vv.v.......vv>>..>>...v>v>....v..v>v.>v....v>v...v.>..>v.v......v>.>.>.v>...>v.>>.vvv>>..v..>.v.>.v..
>v...>......v.vvv..v.vvv.>>.>..v.v.....vv.>.v.>>.v>>v.>>v>vv.v...>...v.>>.v...vvv..>...>.v..>.>.>..>.vv..>.v.v.>v>.vv..vv..vvv>.>.>v...v>v.
.v...v.>..v>..v>v.vv>..vv>.v>..>.v>.vvv>..>v...>v...>v.>..v....>.>..>.v>vv.>...>v>....v...>v.>>..vv.v>.>>...>v>..v...>>v....v.>.vv..>v..vv>
v>.v..vvv.v.....>>>v...>.>v..vvvv.v.>>v>..vv>..vv>..>..........>.>.>..>v.>>v>v.>..>...>>.v.>.>..>..>..>.v.v>v.>>...v...>>>....vv.>..>....v>
...vv>.v...vv......v.>>v.>..>..>..v...>>v..>>.vv>.>.....>>.v.vv.>>.......vv.vv.>....>v.v..>v..v.v>.>v>>..v.v>..>.v>..>..v>.>....>..v.vv..vv
......>.v>>.vv>.>..>v..>.>....>v.v....v.vv>....v.>>..>>.>.vv..v>v>>.>.>v.v>.>.v.>>>...>v..>...v.>v..v.vvvvv>.v>>v......>.>.v>>v..>v..>.....
v>.v>...>v>.vv.>>>.>>v.>>.v>>.v>>...v......v.v...v>>.........v..>.>..v>>.v...v....vvv>.>vv.>..>v>.v>....v......v...vvv>>.....>.v>..>.vv...>
vv.v.....v.......v.>.vv.>vv.v...>>..v..>vv>vv>v>.v.>.>v.vvv>v.>...v.>>...>..v>..>...v..>....>>vvvv.v......v..>...vv>>vv.>..v.v....v>......>
..........>.>..>..>.v>.v>vv.v>>>..>..v.v.vv...v>>>>.vvv...vv>.>.>v>........>>>>v.>>..>v>..v....>>..v>>v>.>vv.>.v>v.>.>.v.>v>.>>v>>>.>..>>vv
>v>.>.>.v>>..v....>.>v..v.vv..>v>...>.v..v>v>.....v...v..vv..>..v..v.v>..>v.v.vv>..>v>.v.>..v...>v>.>v...>...v..>>v.>>..v.>.v.vv.v...v>.>v.
..>.>.v>>..>v..v.>....>>>v...>>..>v>v..vv>..>.....v>vv....v...v.>v.v>v...v.v>.v>>..>v>..>.v.>vv>..>.>>..v....v.....>>>..>..v>>.>..v..>v...>
.>>.v...>v.v...vv>vv.>..>v.>..>..v>>v>..vv..>..v..>..vvv..>>>..>...v>vv>.....>v.v>.>..v>vvv>>.v>.v...>.v>....v.vv...vv>....>>.v.vv.>v>>>.v>
vv>v...>>..v...v..>..>..v>..v>.vvv.v.>.>.....v>.>v.>.>.....vv>.>....v.>...>v...v>>...>..>>v>...>..>v.>vv...v..v.v.v..>.v>v.vv.vv.>.>>vv.>>.
..>....>..>>>....v>v.v.v>.>.>.>vv..v.>v>vvv..>.v.....>.>>>.>.>..v>..>v>.vv>v>>...>v>v..>v>......v>......v>v>v..>>>..v.v.v.>.>>v...v..v>.>.>
v..v>.v>.vv.>.>.v.v.>v....vvv.>.v......>v.>.>>.>>...vvvv>>v..v>>.>v>..>.>...>>..........v.v.>>>..v>.v>>.>..>vv>v.v.>.v.>>.v..>>v>v.>>>vvv>>
v>.vvv>vv>>>v.>>>>vv.....v>>v>>>...>>v.vv.v..>>>>.>......>..>.v..vv.v..v...vv>.v.>v.vv..........>>....v.>v.>vvv>>.>>v>>v>..v>vv..v>.>vv.>..
>vv.v>..>..>.>.v..vv.v>.v>.v>v.>v>>.>v>vv>>>v>.v>...>>>.....vv.......vvv>>...>vv>>..v.v>>.vv...>v>>>.>.v.v..>v..v..........>>vv.vv.>.v.v.v.
>vv.vv.>...v...>v...vv.>....vv..vvv...>>vv>.>vv>v>....>.>.>v.v>..v>....>>>.v.v>....>..>..v>..>.....>...>v..vv.>>.....>>.vv.v...v>....>>..>>
v>>...vvv>.>.v.v.>.>>v.......vv>v>vv.v.>..v.vv...>..>>v.>..>..>.v>vv.>...>>>.v..>...>v...v....>.>...>>..vvv..>>>>..>>...v....vv>..v...>..>.
>.>>>v.>>.>..v>>.>>v>>v>v.>>>v>v>.>..>v>vv...v...v.>.>..>..>....>.>...v..v.v......v........v>.v.vv..v>.>.>v...>....>v.>.>.>v>...v...v..>.>.
v.>...v.>.v..>v.v>.>v...>v.v.>v>.vv..v.>.v>vv....vv....v.>vv>>>vv>>..v.v.>.>v..>v.v>.v>v>>...v.......vv..v>v.v>>v.>vv.v...>.>>v>vv>.>.v.v>>
v.>.>v>.v.v.>v....>.>v>....>v....>>>>..>.>..v..>.v>.....v..v>>>vv.v>.v..vvv.>>>>.....v.vv.vv.v...>..v>...>v..v.>v>v..>v.>.>..v..>v>...vvvv.
..v>..>v..vv>v.v....>.>v.>....>.......>.>vv.....>.>..>>.v......>v>v.>....>>......>>...v>v>vv.v..v>..vv>.>.>v.>.>...>v.v>>...>vv>>>.>v.>.>vv
>.v..v.....>v.>vv>.>v>....v.>v>>vv>.vv..v..v..>..v..>>v..v>.vvv>>.v.vv>>.vv.....v..>..v..>>.v.v>v..>..v.>..>>v.v>...>>vv>>....>>..v>v...v..
.v>vv.>....>v..>.>...v..v.>v...>.>v..v..>>.v....v.v>.v.vvv.v..v>>..>>....>v>v.>vv>.>...>vv.v>v...vvv>v>>..v.v...>vvv.......v>vv.vv..>.>v...
v>>...v>v.......>...>v>>..v>v.v.vv..>>.v.>...vv.v>v.vv>.>.>..>>....v....v>.>...v..v>>v..v>.....>......v.>vv.>..v....>.>.v..>>>.v>.v>v>..vv>
.vvv..........>.>>...>......>.>>....v...>vvvv.......v..>.v.v.......v..v...>.v....v>.vv>>.v.vv.......>...v...>v..v.v.v...vvvv>.>v>.v>>.>>.>.
..v.v>.vv..>v>.v.v...v>.>.v..v.....>>>>v>v..>vvv>v..>>.>>..v>v..vvv..vv>...>.vv..>..v..>..v.v.v...v...vv..v..v>.v..v....>vvv>...v>v..v..>>.
..v......>>>>>v>.>v.>.v..>>v......vv..>....>.>>.>....v>>.vvv.>....v>..v>.>vv..vvv...v>vvv..>...v.>.....v.v>....vv...vv>>>..vv.>>>v..v.v>v>>
.....vv.>>.v>v..>v>.vv.>..>..v>.v>.>v.v.....>v.>vv.>...>....vv>>.>v>>v.>v...>>...v....>v....>..>..v>v>..>..>vv>vvvv.>..v..v>v>.>>.>....>...
..vv>.v..>....v..>>..>>..v..>>>.>>....vv...>.v>v.>v..vv>.v>.v.vv>..v.>.v.v.vvv...v...v>.....vv>..>>.v.v>...>v.v.v.>.v...v..v.v>.....>>vvv.>
.....vv...v.vv>v.>>v..>>>v.>>>.>.>v>>...vv>..>v...v>..>.>....vvv.>v>>.>..>v>..v.>....>>.v>.>v>>.>..>>....>.v.v..v.v>v>..vv.>....v>v>>v..v..
>....>.>v..>>vv..>.>>vvv.v>>....>.>v>..v.....v>.vv>.v>.>v.>.v.vvv>.>....>.>.>v.>>.v.>..>>v>.....>..>..>v...vv>.....v.>..>.v>.v.v.vv.v...>>.
...>...v>>v>..>>..v.vv>.........v...>.vv.>..>>v>v.vv...v>v.>v.>>>>.vv...>..vvv.>.v.....>v.>...v>v.>v..>..>...>...>..v>>>>.vvv>>.>.v...vv.vv
vvv.>.vvv.>>>.v.>>>>>..>..>.>..>..v>..>.>.v>...v.v.v.>.>>>>>.v>v.>v.v.>v..v>.>.......v..>v.>....v....>..>.....>>>..v..vv>>>.>...>..>....vv>
>vv>>..vv.>.>.v>.v.>.vv...>.>.......v>>...vv.vv.>.v...v>v.vvvvvv>v>>>vvvv..>v...>>v>....>>>v.v>>>.>.v..>.v>v.>>.v....v>..>.vvv.>..>.....vv.
v>.v..>.>>vv>vv...>>.>..v>..>>>.v>vvv....>.>>.v.vv.>>v>>>>..vv...>.>v>...v.>v>.v...v.vvvvv>v.....>v>v>>>..v>>.v.v>vv...v>>>>>..vv.>.....v.v
.vvv.v>v>.v>v....vv..v..v>>.v.>...>.>..>..v>.>.>...>.v>........>..>.>v.v>..vv>>.>.>vvvv..vv.>v.>vv.>....>.vv>>>.v.>>......v..>v.vv>v.>.....
>vv.v..vv.v...v.>v.v.vvv>.v.....v..>v..v.v....>..vvvv>.vvv.>..vvvvv.v..>>..>.v..v>v..v..v.>>.>v>>>v..>...v.v>.vv....>v>>.v>.>..>...v>.>v>>.
>...>>v>vv.....v.>.>...vv..vvv.>......>v..vvvv>>v>>v>v>v...>v.v.>.v>..v>.vvv.vv.vv.v....>v.>.>v......>>.>...v.v>.>..v....vv.v>..>...>v....v
v....v>v......>..>.>vv>v.v..v....vv.vv>>>.>v.....>v>..>..>.>.>>.v>>>..>.v.....>.....>...>>>>v..v>..>>..>>...>.>.>....vv......vv...>.v.>...>
....v>>..v>..v....vv...vv>.>..>>.>v..v>..v.vv....v..>..v>>.>.>...>..>...v..v...vv.>.>v..v.v.>.v.>>>v>.vv>>>v....v>.>..v.v..vv..v.>.vvv.v...
vvv.vv.>>.....v.v.>...v...v..v>vv...v>v.....v>.....>v>.>>>>>.vv.v..>.vv..v..v.>vv>vvv>v>....vv......v.>....v.>>v..>..>v.....>.vv.>v>.>..v>.
.v.....v...>v...v.>..>v>....v.v.v..>v..v.>.vv...vv.v.....>v>..v.v>.>....v...vv>..v>v..v.v>>.>>vv>>..>v.vv>v......>...>.>v.v>>......>.>v>>.v
....>v..v.>..v......>.>.v.>>vv>>.>v.>v.......v..>>..v.>v>v..>>..vv..v.vv...vvv.v.>.v.v..v.>>...>>>.....>>..>...v..>.>v.v>vv.v..>v....>..v>v
..v..>>>..vv.v.>.v.>>>.vvv..v....vv>..v>v.v..>v....v.>.....>v..>>.....v>>>.>........v..vv.>v>v.>v.v>.vv>>..>>vv...>>.>vvvv>>.....>..>.>v>>v
>.>>>..v>v.v...>>>...>v>v..........>.>>v....v>....vvv..vvv.>vv.>vvv.v>.>>v...vv>.>.>.v...>v....>v......v>v.v>v>>>...>>....v.v>..>..v>>..>.>
..>...>.v.v.>>>..v>.v..v.>>..v>>>>.vvv.>v.>vv>.>>v>..v...>>>..v.>...vvv......>vv>vvv.v>v.v..v....v>>.>.....>v......v.>v.vv....>>>.>vv..>v.v
vvv.>>>.....>...>vvvvv>>.>>v.>.v...v...v>v>.>....v..>.v>v.vv.v>vv>.v...v..v.v.>v.v>v>..>>>v.v...v...>.....>v..v.>v.v.....>>v.v.v>......>.>>
.>...>..v..v.>...>v..>.>.v>.>>....v..v.v..>>.vvv..>vvv>>...vv..>.>.v>>.v>...>v>.v>v>>>>>>...v....v>>vv.v.v.v..v..>v.....>>>....>.>>>>..v>v.
..v..v..v.>......v.>....>.v>>>>vv..>vvv.>v.v.....vvvvv..>.>.>v.v....>..v..v.v.>>vv...>.>v.>>v.v.v>.>...>..>>.v..vv>.>..v>....vv>..>>v.v.v.>
.>>vv.v.>.>v>>>>..>.>...v..v>v..>vv.>.v.v>...>..>v.>..>......vvv.v>>v>..>>.v>.>v..v>>..>v.>.>.v>>...>.....vv>.>.....>..vvv.vv.v.>..vv.>..v>
...>v.v....vv.>.vv.>>v..>.v....vv...v.>...v......>..v......v>>v.v..>...v..>>>v..v.>>v...v>>.v.....v.v.v.vvvvv>..v>.>vvv>v.v....>>.>..vv.v>.
.vv>.>.vv.>...>>>>.vv.>.>v..v.v>......v.v.vv.v>v>.>>>.v.v.v>>>vv>v>>.....>.v.vv..>>>v>v..v.vv>>..v..>>v>>v>>>.>..>...vv>v...>.>>..>..v.>vv.
>v...v.>>v......vv>...v>..v>vv.>v.>>..v..>v>.vvv>...v....v>.>v>>....v>..>.>.v.>>.....vv..>.v>>.....>vv.....v>.v.>v.v..v.v>vv.>.v>...v.>v..>
.>.v.>.>.v.....>>.>..v....v.v>.v>.>>..v.v...v.v.>.>>.v..>.>vv..v...>.>>.v>.v.v>v.>v>>>v.>>.>...vv.>.>>vv.>.>..v.v.vv>..v>.>.v....v..v..v..>
v.>v>.v.>.v.>>>v.>>v>v...>>>.>v.>>......vvv..v....>.>.>..>..v....>v..v.....>v.>vv.>>>..>.>.>.>>>..>>>....>>v>v.vv>..>....v.>...>.>..v...>.>
v...>v>..>>.>>..vv>>....v..>..>v.v.>.vv.vvv..v.>>vvv>v.v.>vvvv>>.v.v>.>>>....v>v>v>....>>v.........v>v>.>..>.>v>.>vv>v>>...>>...>vv.>.>v..v
>>.>v>vv.>v>..>....v>.vv>v.>.>>.v..>.vv>v.>.>..vvv>v.v.>..>v>v.v.>v>>>>.>vv.>.vv>.>.>>>...v..>>.v..>.vv..>.v..v>..v........>>..v.>>.>v>v.>.
.vv.>.vv.>...v...>vv>v....>>.....>.>.v.>.>..>>v>vv.......vv.>.v.......v..v.vv.vv>>v.v..>.v.....>.>..v....>.v>>v>..>......v>v....vv....>.>>.
..v..>>>.>.....>>v>>v.....>v.vv>v>.>v>v.>..>vv..v....>.vv......>v>v>..v>>>>>v.v>.>..v..v>v.>...>>>vv..>....>v.>v>.v>....v>v.>.>v.>>vvv.v.>v
>.>...>vv.v...v>.....>v.>.>v..>vv>..v>..v.v.vv.>..>>..v....v>>.vv...>.>>v>..>>>v.v.v..vvvv..>>.>>>.>...>v...v.....>.v..>v>vv.v>>.v.v.>.v...
vv.v.>>.v>.v.>v..v..>vvvv.>>....v...>..v.....>v..>..>>>.>.>.v...>>v.v.v.>.v.v......v>>v>.>v.v>.>.v>.....>....>v.vv.vvv>...>.v.v.>>>vvv>>vv>
vv.>...v.>.>.v...v>...........>.v.v.v>vv>>>.>.>v>>>>>vv>.>v>.v..>>.v.>>>>.........>v>...vv.v....v...v...>..v.v...........>>>>vvvvv..>>>>vv>
v>.v......v..v....vvv>.v...v..>vv....v.>.v..>.vv..>vv>vvvv.>v>.>>.>vv>..v>...v...>....>.>vv.>v.>v..>>..v..v...>.vv...vv.>>>>v>...>v.v>...>.
.>v>.>v>vv>vv..vvv>....v>>.>v..>.>.....v...v...v.>.v.v..v.>>v..>>.v..>>.vvvv.>.>....v>.>>>v.v>..vv..>v.>.vv>>.v.vv>>..vvv.v>.>..>..vv.>v...
>.....v>v>>v..>.>v.>>..v.....>>..vv.v.v>v>..>..>...v>v.v>...v....>.>vv...v>>v..v.>.>..>v>...>>>>>..>>....>.>>v..>.>>.>v>>>>>...>.>..v.vvv.v
.>..>.vv>>..>v..>v>.v.v.>...>v.vvv>vvv..>>>>.>..>v..>v..v>v......>v....>.>.>>.>...>.v>v>...>v>>...>>..vv....v>..>v>>.>.>v.>>.v.v.v>..>>>>>.
>...>.>>>v>vvv..v>v.>>...v...vv.v>v..>>...v>....v..v..vvv..v..>.>.....vvv..>v..v>...>.>>v..vv....>v.>v...>.vvvv.>.v...>>.>.>v>v..v..v..>>>>
..>>.v.v..v..v>..vvv>...>>....>vv>....>>.>....>...>>>..v.v...vv>>>v>vv.>..>>>.>v.v.>.>.....v.v>.>>>>>>vv.vv.>..v..>.v>>>vv>....>.v>v...>..v
..>..v.....>>..>...v>.v>..>>>..v>.vv.>>..v.v>>..>.>v>...>.v>...>.v>.>>.>>...vv..>.>..v..v.v>v.>.>>....>v..>.>.>.>..v>.......vv.>>>>.>.>v...
v.>>v>.v..vv.v>.>.>.v........>.v>..>v>>.>.v.....>>.v>v>>.>>.>>v>....vvv>v>..v.>v..v...>....>.>>.>.vv.v.>v....v>..v..v.>...>.>>v...vvvvv>>..
....>v>>.vvv>v.v>v.>....v>v.vv..>v>>v..v.v..v..v.v.v.>>..>>>.>..>>>>v.v..>.>v....>..v.>v...v>>vv>v>..>.v...v.......vvv.v.vvv>v..v.>.vv>>..v
.v.>...>>>>v>.>.......v>v.vvvv..>.>>v.v.>.vv...v...v........v>>v.>.....vv..v.>.v.>...>..v>>v>.v>>v.v.v>.>vv..>...v..vvv>v>vv.v.v>>vv...v>v>
v...>..>>..>.>..>.>>.v>v..>>>>v.vv>.>.>.>v.........v>>.>>.>..>.v.>.v..>>....>.v.>>.>.>.vv.>>v>>vv.v>.....>v.v>..v.>>..vvv...v>>>>vv..v>v>v.
..v...>v>.>v...>..>>vv>>>.>...>.>>......>.v>..v>.vv.>vvvvv>>....vv>..>..>>v....vv..v>v>.....vvv..>.>..v.v>.v..>........>>>>.>....>>.>.>.vv.
>..>v.v.....v>.....>..vv...>...v>vv.v.>>.....v>v...>.v.>.>>v.>v.>>v>.>>...>..v....>...>vvv>..v.>...>>.v>>.vv..>..>>.>v.v.v..>v.vv..v...v>..
..>v.vv.v>..>>v...vv.v..vvv.>...>.>vv>..v.v>vv>>....>.v>vvv.vv....v.v.vv.>v...v...vv.v>..>.>.......v..vv>v>v>...>>.v...>..>.>..>>>v...v....
v>vv.v>.>..v>>v.v..>>....vv.v........>>.>>...>.>.v.vv.v..v..>v>.>..>>.v.>.....v..v>..v..v>...vv.>>v>.>....>v>.v.>........v..v.>..v.v>>>....
>...vv...>.v>.>..>.....>..>v>>>.v....v.vv..v....v.>.>..>.>v..>...v.>..>..>.>v.>v>.v.vvvv..v..>...v.v.v.v>...>>.>>.v>v>>>v.>..v.v.v>...>.v..
.>.>.v.>>>..>..>...vvv>.>....v....>v..>v...v>.>..v>...>>>..v..>>.v>v.....>.v..>...>.v.vvv.v.>v.vv>>>.>v>..>.>.v.>.>>.>.>v..v....>...>...v.v
`
)

const (
	SouthFacing = 1
	EastFacing  = 2
)

func main() {
	var coords []maps.Coordinate
	values := make(map[maps.Coordinate]int)
	for y, row := range util.ReadInput(in, "\n") {
		for x, cell := range row {
			var val int
			switch cell {
			case 'v':
				val = SouthFacing
			case '>':
				val = EastFacing
			}

			c := maps.Coordinate{X: x, Y: y}
			coords = append(coords, c)
			values[c] = val
		}
	}

	m := maps.MapFromCoordinates(coords)
	for c, v := range values {
		m.Set(c, v)
	}

	fmt.Printf("first: %d\n", first(m))
}

func destination(m maps.IntMap, direction int, at maps.Coordinate) maps.Coordinate {
	switch direction {
	case EastFacing:
		next := maps.Coordinate{Y: at.Y, X: at.X + 1}
		if !m.Exists(next) {
			next.X = 0
		}
		return next

	case SouthFacing:
		next := maps.Coordinate{Y: at.Y + 1, X: at.X}
		if !m.Exists(next) {
			next.Y = 0
		}
		return next

	default:
		return maps.Coordinate{}
	}
}

func first(m maps.IntMap) int {
	for step := 1; ; step++ {
		eastMoves := getMoves(m, EastFacing)
		southMoves := getMoves(m, SouthFacing)
		if len(eastMoves) == 0 && len(southMoves) == 0 {
			return step
		}
	}
}

func getMoves(m maps.IntMap, direction int) map[maps.Coordinate]maps.Coordinate {
	moves := make(map[maps.Coordinate]maps.Coordinate)
	for y, row := range m.Cells {
		for x, val := range row {
			if val != direction {
				continue
			}

			at := maps.Coordinate{Y: y, X: x}
			dest := destination(m, val, at)
			if m.At(dest) == 0 {
				moves[at] = dest
			}
		}
	}

	for from, to := range moves {
		m.Set(to, m.At(from))
		m.Set(from, 0)
	}

	return moves
}
